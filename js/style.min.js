var User = [];
var currentUser = 1;

hideUser();

function hideUser() {
    document.getElementById("viewUsers").style.display = "none";
}

function viewUser() {
    document.getElementById("inputData").style.display = "none";
    document.getElementById("viewUsers").style.display = "block";
}

function numbersOnly(evt) {
    var myEvt = evt || window.event;
    var key = myEvt.keyCode || myEvt.which;
    key = String.fromCharCode(key);
    var regex = /[0-9]/;

    if (!regex.test(key)) {
        myEvt.returnValue = false;
        if (myEvt.preventDefault) myEvt.preventDefault();
    }
}

function load() {
    document.getElementById("userDetails").innerHTML = "";
    if (localStorage.UserRecords) {
        User = JSON.parse(localStorage.UserRecords);
        for (var i = 0; i < User.length; i++) {
            view(i, User[i].nome, User[i].sobrenome, User[i].email, User[i].telefone, User[i].nascimento, User[i].profissao, User[i].sexo, User[i].civil);
        }
    }
    clearFields();
}

function store() {
    var nome = document.getElementById("nome").value;
    var sobrenome = document.getElementById("sobrenome").value;
    var email = document.getElementById("email").value;
    var telefone = document.getElementById("telefone").value;
    var nascimento = document.getElementById("nascimento").value;
    var profissao = document.getElementById("profissao").value;
    var sexo = document.getElementById("sexo").value;
    var civil = document.getElementById("civil").value;

    var UserObj = {
        nome: nome,
        sobrenome: sobrenome,
        email: email,
        telefone: telefone,
        nascimento: nascimento,
        profissao: profissao,
        sexo: sexo,
        civil: civil
    };

    if (currentUser == 1) {
        User.push(UserObj);
    } else {
        User.splice(currentUser, 1, UserObj);
    }

    localStorage.UserRecords = JSON.stringify(User);

    load();

    clearFields();

}

function view(id, nome, sobrenome, email, telefone, nascimento, profissao, sexo, civil) {
    var view = document.getElementById("userDetails");

    var insertRows = view.insertRow();

    insertRows.insertCell(0).innerHTML = id + 1;
    insertRows.insertCell(1).innerHTML = nome;
    insertRows.insertCell(2).innerHTML = sobrenome;
    insertRows.insertCell(3).innerHTML = email;
    insertRows.insertCell(4).innerHTML = telefone;
    insertRows.insertCell(5).innerHTML = nascimento;
    insertRows.insertCell(6).innerHTML = '<div id="action"><button class="btn bg-transparent" onclick="edit(' + id + ')"><strong style="color: #ffc107 "><i class="fa fa-pencil-square-o fa-lg" aria-hidden="true" title="Editar pessoa"></i></strong></button> <button class="btn bg-transparent" onclick="wipe(' + id + ')"><strong style="color: #dc3545"><i class="fa fa-trash fa-lg" aria-hidden="true" title="Excluir pessoa"></i></strong></button></div>';
}

function wipe(id) {

    User.splice(id, 1);
    localStorage.UserRecords = JSON.stringify(User);
    load();
}

function clearFields() {
    currentUser = 1;

    document.getElementById("nome").value = "";
    document.getElementById("sobrenome").value = "";
    document.getElementById("email").value = "";
    document.getElementById("telefone").value = "";
    document.getElementById("nascimento").value = "";
    document.getElementById("profissao").value = "";
    document.getElementById("sexo").value = "";
    document.getElementById("civil").value = "";
    document.getElementById("submit").innerHTML = "Salvar";
}

function edit(id) {
    currentUser = id;
    var UserObj = User[id];

    document.getElementById("inputData").style.display = "block";
    document.getElementById("viewUsers").style.display = "none";

    document.getElementById("nome").value = UserObj.nome;
    document.getElementById("sobrenome").value = UserObj.sobrenome;
    document.getElementById("email").value = UserObj.email;
    document.getElementById("telefone").value = UserObj.telefone;
    document.getElementById("nascimento").value = UserObj.nascimento;
    document.getElementById("profissao").value = UserObj.profissao;
    document.getElementById("sexo").value = UserObj.sexo;
    document.getElementById("civil").value = UserObj.civil;
    document.getElementById("submit").innerHTML = "Alterar";
}